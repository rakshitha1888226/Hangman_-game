<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hangman ‚Äì Unlimited Word Length</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #121212;
    color: #e0e0e0;
    text-align: center;
    padding: 20px;
  }
  #category {
    font-size: 1.4rem;
    margin-bottom: 10px;
    color: #7fffd4;
  }
  canvas {
    background: #222;
    border-radius: 10px;
    display: block;
    margin: 20px auto;
  }
  #wordContainer {
    font-size: 2.5rem;
    letter-spacing: 8px;
    margin: 20px 0;
    word-wrap: break-word;
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
  }
  #letters {
    display: inline-flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 6px;
    max-width: 90%;
  }
  .letter-btn {
    width: 36px; height: 36px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    background: #0ff;
    border: none;
    border-radius: 4px;
    color: #121212;
  }
  .letter-btn:disabled {
    background: #444;
    color: #999;
    cursor: default;
  }
  #message {
    font-size: 1.3rem;
    height: 2em;
    margin: 10px 0;
  }
  #restartBtn {
    padding: 10px 18px;
    font-size: 1.2rem;
    cursor: pointer;
    background: #7fffd4;
    border: none;
    border-radius: 6px;
    color: #121212;
  }
  #restartBtn:disabled {
    background: #444;
    color: #777;
    cursor: default;
  }
</style>
</head>
<body>

<h1>Hangman:‚úåÔ∏è</h1>
<div id="category">Loading category...</div>
<canvas id="hangmanCanvas" width="240" height="320"></canvas>
<div id="wordContainer"></div>
<div id="letters"></div>
<div id="message"></div>
<button id="restartBtn" disabled>Restart</button>

<script>
(async () => {
  const apiURL = 'https://opentdb.com/api.php?amount=1&type=multiple';
  const maxWrong = 6;

  let word = '', guessed = new Set(), wrong = 0, gameOver = false;

  const categoryDiv = document.getElementById('category');
  const wordContainer = document.getElementById('wordContainer');
  const lettersDiv = document.getElementById('letters');
  const messageDiv = document.getElementById('message');
  const restartBtn = document.getElementById('restartBtn');
  const canvas = document.getElementById('hangmanCanvas');
  const ctx = canvas.getContext('2d');

  function decodeHTML(html) {
    const txt = document.createElement('textarea');
    txt.innerHTML = html;
    return txt.value;
  }

  function sanitize(str) {
    return str.toLowerCase().replace(/[^a-z]/g, '');
  }

  async function fetchWord() {
    let data = await fetch(apiURL).then(r => r.json());
    if(!data.results?.length) throw 'No data';
    let ans = decodeHTML(data.results[0].correct_answer);
    return {
      category: data.results[0].category,
      word: sanitize(ans) || 'apple'
    };
  }

  function setup() {
    guessed.clear(); wrong = 0; gameOver = false;
    messageDiv.textContent = '';
    restartBtn.disabled = true;
    createButtons(); draw(); updateDisplay();
  }

  function createButtons() {
    lettersDiv.innerHTML = '';
    for(let i=65;i<=90;i++){
      let letter = String.fromCharCode(i);
      let btn = document.createElement('button');
      btn.className = 'letter-btn';
      btn.textContent = letter;
      btn.onclick = () => guess(letter.toLowerCase(), btn);
      lettersDiv.appendChild(btn);
    }
  }

  function guess(letter, btn) {
    if(gameOver || guessed.has(letter)) return;
    guessed.add(letter); btn.disabled = true;
    if(!word.includes(letter)) wrong++;
    draw(); updateDisplay();
    checkEnd();
  }

  function updateDisplay() {
    let disp = '';
    for(let ch of word) {
      disp += guessed.has(ch) ? ch.toUpperCase() + ' ' : '_ ';
    }
    wordContainer.textContent = disp.trim();
  }

  function checkEnd() {
    if([...word].every(ch => guessed.has(ch))) {
      messageDiv.textContent = 'üéâ You Win!';
      endGame();
    } else if(wrong >= maxWrong) {
      messageDiv.textContent = `üòû You Lose. Word was "${word.toUpperCase()}".`;
      endGame();
    }
  }

  function endGame() {
    gameOver = true;
    [...lettersDiv.children].forEach(b => b.disabled=true);
    restartBtn.disabled = false;
  }

  function draw() {
    ctx.clearRect(0,0,240,320);
    ctx.strokeStyle = '#0ff'; ctx.lineWidth = 4;
    // base & pole
    ctx.beginPath();
    ctx.moveTo(20,300); ctx.lineTo(220,300);
    ctx.moveTo(60,300); ctx.lineTo(60,20);
    ctx.lineTo(160,20); ctx.lineTo(160,60);
    ctx.stroke();

    if(wrong > 0){
      ctx.beginPath(); ctx.arc(160, 90, 30, 0, Math.PI*2); ctx.stroke();
    }
    if(wrong > 1){
      ctx.beginPath(); ctx.moveTo(160,120); ctx.lineTo(160,200); ctx.stroke();
    }
    if(wrong > 2){
      ctx.beginPath(); ctx.moveTo(160,140); ctx.lineTo(120,170); ctx.stroke();
    }
    if(wrong > 3){
      ctx.beginPath(); ctx.moveTo(160,140); ctx.lineTo(200,170); ctx.stroke();
    }
    if(wrong > 4){
      ctx.beginPath(); ctx.moveTo(160,200); ctx.lineTo(120,260); ctx.stroke();
    }
    if(wrong > 5){
      ctx.beginPath(); ctx.moveTo(160,200); ctx.lineTo(200,260); ctx.stroke();
    }
  }

  restartBtn.onclick = async () => {
    let d = await fetchWord();
    categoryDiv.textContent = `Category: ${d.category}`;
    word = d.word;
    setup();
  };

  // Start
  restartBtn.disabled = true;
  let d = await fetchWord();
  categoryDiv.textContent = `Category: ${d.category}`;
  word = d.word;
  setup();

})();</script>

</body>
</html>
